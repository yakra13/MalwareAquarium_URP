using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class LightManager : MonoBehaviour
{
    public Light mainLight;
    public Light fillCool;
    public Light fillWarm;

    [SerializeField] private float cycleTime = 20.0f;
    [SerializeField] private float blendDuration = 10.0f;
    float elapsedTime = 0.0f;

    [SerializeField] private float minMainIntensity = 0.0f;
    [SerializeField] private float minCoolIntensity = 0.01f;
    [SerializeField] private float minWarmIntensity = 0.01f;

    float mainDefaultIntensity;
    float coolDefaultIntensity;
    float warmDefaultIntensity;


    bool isNight = false;

    // Start is called before the first frame update
    void Start()
    {
        mainDefaultIntensity = mainLight.intensity;
        coolDefaultIntensity = fillCool.intensity;
        warmDefaultIntensity = fillWarm.intensity;
    }

    // Update is called once per frame
    void Update()
    {
        elapsedTime += Time.deltaTime;
        if(elapsedTime >= cycleTime)
        {
            StartCoroutine(BlendLightIntensity(mainLight,
                                               isNight ? minMainIntensity : mainDefaultIntensity,
                                               isNight ? mainDefaultIntensity : minMainIntensity));
            StartCoroutine(BlendLightIntensity(fillCool,
                                               isNight ? minCoolIntensity : coolDefaultIntensity,
                                               isNight ? coolDefaultIntensity : minCoolIntensity));
            StartCoroutine(BlendLightIntensity(fillWarm,
                                               isNight ? minWarmIntensity : warmDefaultIntensity,
                                               isNight ? warmDefaultIntensity : minWarmIntensity));

            isNight = !isNight;

            elapsedTime = 0.0f;
        }
    }

    IEnumerator BlendLightIntensity(Light l, float start, float end)
    {
        float elapsed = 0f;

        while (elapsed < blendDuration)
        {
            l.intensity = Mathf.Lerp(start, end, elapsed / blendDuration);
            elapsed += Time.deltaTime;
            yield return null;
        }

        l.intensity = end;
    }

    public bool GetIsNight()
    {
        return isNight;
    }
}
