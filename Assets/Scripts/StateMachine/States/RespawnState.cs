using UnityEngine;
using static System.TimeZoneInfo;

public class RespawnState : BaseState
{
    private float _transition = 0.0f;
    private float _transitionTime = 5.0f;//fade in over 5 seconds...
    private Material _material;
    public RespawnState(StateMachine context, StateFactory factory)
        : base(context, factory)
    {
        _material = context.GetComponent<Renderer>().material;
    }

    public override void EnterState()
    {
        //move to random spawn location
        _context.transform.position = _context.Boid.GetRandomSpawnLocation();
        _context.Boid.ChangeTargetRandom();

        //reset stats
        _context.CurrentBoredom = 0;
        _context.CurrentFullness = _context.Boid.boidData.maxFullness;
        _context.CurrentHealth = _context.Boid.boidData.maxHealth;

        //reset the material
        _material.SetFloat("_Transition_Sick_Low", 0.0f);
        _material.SetFloat("_Transition_Sick_Med", 0.0f);
        _material.SetFloat("_Transition_Sick_High", 0.0f);

        //make sure enable dissolve is on to fade in
        _material.SetInt("_EnableDissolve", 1);
    }

    public override void UpdateState()
    {
        _transition += Time.deltaTime / _transitionTime;
        _material.SetFloat("_DissolveTransition", Mathf.Clamp(_transition, 0f, 1f));

        CheckSwitchStates();
    }

    public override void ExitState()
    {
        //disable dissolve
        _material.SetInt("_EnableDissolve", 1);
        _material.SetFloat("_DissolveTransition", 0.0f);
    }

    public override void CheckSwitchStates()
    {
        if (_transition >= 1.0f)
            SwitchState(_factory.Explore());
    }

    public override void InitializeSubState()
    {
        //TODO
    }
}
